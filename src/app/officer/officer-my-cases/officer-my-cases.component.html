<div class="officer-cases-container">
  <div class="header-section">
    <h2>My Assigned Cases</h2>
    <div class="header-actions">
      <button mat-raised-button color="primary" (click)="refresh()" [disabled]="loading">
        <mat-icon>refresh</mat-icon>
        Refresh
      </button>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <mat-form-field appearance="outline" class="action-filter">
      <mat-label>Filter by action</mat-label>
      <mat-select [value]="selectedActionCode" (selectionChange)="filterByAction($event.value)">
        <mat-option [value]="null">All actions</mat-option>
        <mat-option *ngFor="let a of actionTypes" [value]="a.code">{{ a.label }}</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline" class="search-field">
      <mat-label>Search</mat-label>
      <input matInput [(ngModel)]="searchTerm" (keyup)="applySearch()" placeholder="Case number, applicant name, subject...">
      <mat-icon matPrefix>search</mat-icon>
    </mat-form-field>

    <mat-form-field appearance="outline" class="status-filter">
      <mat-label>Filter by Status</mat-label>
      <mat-select [(ngModel)]="filterStatus" (selectionChange)="filterByStatus($event.value)">
        <mat-option [value]="null">All Statuses</mat-option>
        <mat-option value="SUBMITTED">Submitted</mat-option>
        <mat-option value="APPROVED">Approved</mat-option>
        <mat-option value="REJECTED">Rejected</mat-option>
        <mat-option value="RETURNED_FOR_CORRECTION">Returned for Correction</mat-option>
        <mat-option value="PENDING">Pending</mat-option>
        <mat-option value="IN_REVIEW">In Review</mat-option>
        <mat-option value="COMPLETED">Completed</mat-option>
      </mat-select>
    </mat-form-field>

    <button mat-button (click)="clearFilters()" *ngIf="filterStatus || searchTerm || selectedActionCode">
      <mat-icon>clear</mat-icon>
      Clear Filters
    </button>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading cases...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error && !loading" class="error-container">
    <mat-icon color="warn">error</mat-icon>
    <p>{{ error }}</p>
    <button mat-raised-button color="primary" (click)="loadCases()">Retry</button>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && !error && dataSource.data.length === 0" class="empty-state">
    <mat-icon>inbox</mat-icon>
    <h3>No cases assigned</h3>
    <p>You don't have any cases assigned to you at the moment.</p>
  </div>

  <!-- Cases Table -->
  <div *ngIf="!loading && !error && dataSource.data.length > 0" class="table-container">
    <table mat-table [dataSource]="dataSource" matSort class="cases-table">
      <!-- Case Number Column -->
      <ng-container matColumnDef="caseNumber">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Case Number</th>
        <td mat-cell *matCellDef="let caseItem">
          <strong>{{ caseItem.caseNumber }}</strong>
        </td>
      </ng-container>

      <!-- Applicant Name Column -->
      <ng-container matColumnDef="applicantName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Applicant</th>
        <td mat-cell *matCellDef="let caseItem">
          <div class="applicant-info">
            <span class="name">{{ caseItem.applicantName }}</span>
            <span class="mobile" *ngIf="caseItem.applicantMobile">{{ caseItem.applicantMobile }}</span>
          </div>
        </td>
      </ng-container>

      <!-- Subject Column -->
      <ng-container matColumnDef="subject">
        <th mat-header-cell *matHeaderCellDef>Subject</th>
        <td mat-cell *matCellDef="let caseItem" class="subject-cell">
          {{ caseItem.subject }}
        </td>
      </ng-container>

      <!-- Status Column -->
      <ng-container matColumnDef="currentStateName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
        <td mat-cell *matCellDef="let caseItem">
          <span [class]="'status-badge ' + getStatusClass(caseItem.currentStateName || caseItem.status)">
            {{ caseItem.currentStateName || caseItem.status }}
          </span>
        </td>
      </ng-container>

      <!-- Priority Column -->
      <ng-container matColumnDef="priority">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Priority</th>
        <td mat-cell *matCellDef="let caseItem">
          <span [class]="'priority-badge ' + getPriorityClass(caseItem.priority)">
            {{ caseItem.priority }}
          </span>
        </td>
      </ng-container>

      <!-- Application Date Column -->
      <ng-container matColumnDef="applicationDate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Application Date</th>
        <td mat-cell *matCellDef="let caseItem">
          {{ caseItem.applicationDate | date: 'dd/MM/yyyy' }}
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let caseItem">
          <button mat-raised-button color="primary" (click)="viewCase(caseItem.id)">
            <mat-icon>visibility</mat-icon>
            View & Take Action
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <mat-paginator
      [pageSizeOptions]="[10, 25, 50, 100]"
      showFirstLastButtons
      aria-label="Select page of cases">
    </mat-paginator>
  </div>
</div>

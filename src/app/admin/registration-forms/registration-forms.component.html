<div class="registration-forms-container">
  <div class="header-section">
    <h2>
      <mat-icon>dynamic_form</mat-icon>
      Registration Form Fields Management
    </h2>
    <p class="subtitle">Configure registration form fields for Citizen and Lawyer</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="error-alert">
    <mat-icon>error</mat-icon>
    <span>{{ errorMessage }}</span>
  </div>

  <!-- Tabs for Citizen and Lawyer -->
  <mat-tab-group [(selectedIndex)]="selectedTab" (selectedIndexChange)="onTabChange($event)" class="form-tabs">
    <mat-tab label="Citizen Registration">
      <ng-template mat-tab-label>
        <mat-icon>person</mat-icon>
        Citizen Registration
      </ng-template>
    </mat-tab>
    <mat-tab label="Lawyer Registration">
      <ng-template mat-tab-label>
        <mat-icon>gavel</mat-icon>
        Lawyer Registration
      </ng-template>
    </mat-tab>
    <mat-tab label="Field Groups">
      <ng-template mat-tab-label>
        <mat-icon>folder</mat-icon>
        Field Groups
      </ng-template>
      <div class="tab-content">
        <app-registration-form-groups [registrationType]="selectedGroupType"></app-registration-form-groups>
      </div>
    </mat-tab>
  </mat-tab-group>

  <!-- Fields Management (only for Citizen and Lawyer tabs) -->
  <div *ngIf="selectedTab < 2" class="fields-management">
    <!-- Actions Bar -->
    <div class="actions-bar">
      <button mat-raised-button color="primary" (click)="openCreateDialog()">
        <mat-icon>add</mat-icon>
        Add Field
      </button>
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Search Fields</mat-label>
        <input matInput (keyup)="applyFilter($event)" placeholder="Search by label, name, or type">
        <mat-icon matPrefix>search</mat-icon>
      </mat-form-field>
    </div>

    <!-- Loading Spinner -->
    <div *ngIf="isLoading" class="loading-container">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Loading fields...</p>
    </div>

    <!-- Fields Table -->
    <div *ngIf="!isLoading" class="table-container">
    <table mat-table [dataSource]="dataSource" matSort class="fields-table">
      
      <!-- Display Order Column -->
      <ng-container matColumnDef="displayOrder">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Order</th>
        <td mat-cell *matCellDef="let field">{{ field.displayOrder }}</td>
      </ng-container>

      <!-- Field Label Column -->
      <ng-container matColumnDef="fieldLabel">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Field Label</th>
        <td mat-cell *matCellDef="let field">
          <strong>{{ field.fieldLabel }}</strong>
          <span *ngIf="field.isRequired" class="required-badge">*</span>
        </td>
      </ng-container>

      <!-- Field Name Column -->
      <ng-container matColumnDef="fieldName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Field Name</th>
        <td mat-cell *matCellDef="let field">
          <code>{{ field.fieldName }}</code>
        </td>
      </ng-container>

      <!-- Field Type Column -->
      <ng-container matColumnDef="fieldType">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Type</th>
        <td mat-cell *matCellDef="let field">
          <span class="field-type-badge">{{ getFieldTypeDisplay(field.fieldType) }}</span>
        </td>
      </ng-container>

      <!-- Required Column -->
      <ng-container matColumnDef="isRequired">
        <th mat-header-cell *matHeaderCellDef>Required</th>
        <td mat-cell *matCellDef="let field">
          <mat-icon *ngIf="field.isRequired" color="primary">check_circle</mat-icon>
          <mat-icon *ngIf="!field.isRequired" color="disabled">cancel</mat-icon>
        </td>
      </ng-container>

      <!-- Field Group Column -->
      <ng-container matColumnDef="fieldGroup">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Group</th>
        <td mat-cell *matCellDef="let field">
          {{ field.fieldGroup || '-' }}
        </td>
      </ng-container>

      <!-- Active Column -->
      <ng-container matColumnDef="isActive">
        <th mat-header-cell *matHeaderCellDef>Active</th>
        <td mat-cell *matCellDef="let field">
          <mat-icon *ngIf="field.isActive" color="primary">check_circle</mat-icon>
          <mat-icon *ngIf="!field.isActive" color="disabled">cancel</mat-icon>
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let field">
          <button mat-icon-button color="primary" (click)="openEditDialog(field)" matTooltip="Edit Field">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button color="warn" (click)="deleteField(field)" matTooltip="Delete Field">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      <!-- No data row -->
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" [attr.colspan]="displayedColumns.length">
          <div class="no-data-message">
            <mat-icon>info</mat-icon>
            <p>No fields found. Click "Add Field" to create one.</p>
          </div>
        </td>
      </tr>
    </table>

      <mat-paginator [pageSizeOptions]="[10, 25, 50, 100]" showFirstLastButtons></mat-paginator>
    </div>
  </div>
</div>

<mat-card-content>
  <!-- ================= SINGLE ENTRY FORM ================= -->
  <div class="form-section">
    <div class="form-header">
      <div class="form-header-content">
        <mat-icon class="header-icon">description</mat-icon>
        <div>
          <h3 class="form-title">
            {{ editMode ? "Edit Document" : "Add New Document" }}
          </h3>
          <p class="form-subtitle">
            {{
              editMode
                ? "Update the selected document"
                : "Upload a document or provide a link"
            }}
          </p>
        </div>
      </div>
      <button
        mat-icon-button
        color="warn"
        type="button"
        (click)="cancelEdit()"
        *ngIf="editMode"
        matTooltip="Cancel editing"
      >
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <form [formGroup]="form" (ngSubmit)="save()" class="entry-form">
      <div class="form-grid">
        <!-- Title Field -->
        <mat-form-field appearance="outline" class="title-field">
          <mat-label>Document Title *</mat-label>
          <input
            matInput
            formControlName="title"
            placeholder="Enter document title"
          />
          <mat-icon matPrefix>title</mat-icon>
          <mat-error *ngIf="form.get('title')?.hasError('required')">
            Title is required
          </mat-error>
        </mat-form-field>

        <!-- Upload Type Toggle -->
        <div class="upload-type-toggle">
          <mat-button-toggle-group
            formControlName="uploadType"
            (change)="onUploadTypeChange()"
            class="full-width"
          >
            <mat-button-toggle value="file">
              <mat-icon>cloud_upload</mat-icon>
              Upload File
            </mat-button-toggle>
            <mat-button-toggle value="url">
              <mat-icon>link</mat-icon>
              Add URL
            </mat-button-toggle>
          </mat-button-toggle-group>
        </div>

        <!-- File Upload Section -->
        <div class="file-upload-section" *ngIf="uploadType === 'file'">
          <div class="file-upload-container">
            <input
              type="file"
              #fileInput
              accept=".pdf,.doc,.docx,.png,.jpg,.jpeg"
              (change)="onFileSelected($event)"
              style="display: none"
            />

            <button
              mat-stroked-button
              type="button"
              color="primary"
              (click)="fileInput.click()"
              class="upload-trigger"
            >
              <mat-icon>attach_file</mat-icon>
              {{ selectedFile ? "Change File" : "Choose File" }}
            </button>

            <div class="file-info" *ngIf="selectedFile">
              <mat-icon class="file-icon">{{
                getFileIcon(selectedFile.name)
              }}</mat-icon>
              <div class="file-details">
                <span class="file-name">{{ selectedFile.name }}</span>
                <span class="file-size">{{
                  formatFileSize(selectedFile.size)
                }}</span>
              </div>
              <button
                mat-icon-button
                type="button"
                color="warn"
                (click)="removeFile()"
                matTooltip="Remove file"
              >
                <mat-icon>close</mat-icon>
              </button>
            </div>

            <div class="upload-hint" *ngIf="!selectedFile">
              <mat-icon>info</mat-icon>
              <span
                >Supported formats: PDF, DOC, DOCX, PNG, JPG (Max 10MB)</span
              >
            </div>
          </div>
        </div>

        <!-- URL Input Section -->
        <div class="url-input-section" *ngIf="uploadType === 'url'">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Document URL *</mat-label>
            <input
              matInput
              formControlName="url"
              placeholder="https://example.com/document.pdf"
            />
            <mat-icon matPrefix>link</mat-icon>
            <mat-hint>Enter the full URL to the document</mat-hint>
            <mat-error *ngIf="form.get('url')?.hasError('required')">
              URL is required when not uploading a file
            </mat-error>
            <mat-error *ngIf="form.get('url')?.hasError('pattern')">
              Please enter a valid URL
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button
            mat-raised-button
            color="primary"
            type="submit"
            [disabled]="
              saving || form.invalid || (uploadType === 'file' && !selectedFile)
            "
            class="save-btn"
          >
            <mat-icon *ngIf="!saving">{{
              editMode ? "update" : "save"
            }}</mat-icon>
            <mat-spinner
              *ngIf="saving"
              diameter="20"
              class="button-spinner"
            ></mat-spinner>
            {{
              saving
                ? "Saving..."
                : editMode
                  ? "Update Document"
                  : "Add Document"
            }}
          </button>

          <button
            mat-stroked-button
            type="button"
            (click)="resetForm()"
            [disabled]="saving"
            class="reset-btn"
          >
            <mat-icon>refresh</mat-icon>
            Reset
          </button>
        </div>
      </div>
    </form>
  </div>

  <mat-divider class="section-divider"></mat-divider>

  <!-- ================= DATA TABLE ================= -->
  <div class="table-section">
    <table mat-table [dataSource]="dataSource" class="custom-table">
      <!-- Icon Column -->
      <ng-container matColumnDef="icon">
        <th mat-header-cell *matHeaderCellDef class="icon-column">
          <div class="header-cell">
            <mat-icon>category</mat-icon>
          </div>
        </th>
        <td mat-cell *matCellDef="let element">
          <mat-icon [class.pdf-icon]="isPDF(element.filePath)">
            {{ getDocumentIcon(element.filePath) }}
          </mat-icon>
        </td>
      </ng-container>

      <!-- Title Column -->
      <ng-container matColumnDef="title">
        <th mat-header-cell *matHeaderCellDef>Title</th>
        <td mat-cell *matCellDef="let element">
          {{ element.title }}
        </td>
      </ng-container>

      <!-- Published On Column -->
      <ng-container matColumnDef="publishedOn">
        <th mat-header-cell *matHeaderCellDef>Published On</th>
        <td mat-cell *matCellDef="let element">
          {{ element.publishedOn | date: "mediumDate" }}
        </td>
      </ng-container>

      <!-- Document Column -->
      <ng-container matColumnDef="document">
        <th mat-header-cell *matHeaderCellDef>Document</th>
        <td mat-cell *matCellDef="let element">
          <a
            [href]="element.filePath"
            target="_blank"
            mat-button
            color="primary"
          >
            <mat-icon>open_in_new</mat-icon>
            View
          </a>
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let element">
          <button mat-icon-button color="primary" (click)="edit(element)">
            <mat-icon>edit</mat-icon>
          </button>

          <button
            mat-icon-button
            color="warn"
            (click)="delete(element.documentId)"
          >
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <!-- Header -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>

      <!-- Rows -->
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

      <!-- No Data -->
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" [attr.colspan]="displayedColumns.length">
          No documents available
        </td>
      </tr>
    </table>

    <mat-paginator
      [pageSize]="10"
      [pageSizeOptions]="[5, 10, 25, 50]"
      showFirstLastButtons
    >
    </mat-paginator>
  </div>
</mat-card-content>

<div class="workflow-transitions-container">
  <div class="section-header">
    <h2>
      <mat-icon>swap_horiz</mat-icon>
      Workflow Transitions
    </h2>
    <button mat-raised-button color="primary" (click)="openCreateDialog()" [disabled]="states.length < 2">
      <mat-icon>add</mat-icon>
      Add Transition
    </button>
  </div>
  <p *ngIf="states.length < 2" class="info-message">
    <mat-icon>info</mat-icon>
    You need at least 2 states to create transitions.
  </p>

  <div class="table-wrapper">
    <table mat-table [dataSource]="dataSource" class="transitions-table">
      <ng-container matColumnDef="transitionCode">
        <th mat-header-cell *matHeaderCellDef>Code</th>
        <td mat-cell *matCellDef="let transition">
          <span class="code-text">{{ transition.transitionCode }}</span>
        </td>
      </ng-container>

      <ng-container matColumnDef="transitionName">
        <th mat-header-cell *matHeaderCellDef>Name</th>
        <td mat-cell *matCellDef="let transition">{{ transition.transitionName }}</td>
      </ng-container>

      <ng-container matColumnDef="fromState">
        <th mat-header-cell *matHeaderCellDef>From State</th>
        <td mat-cell *matCellDef="let transition">
          <span class="state-badge">{{ getStateName(transition.fromStateId) }}</span>
        </td>
      </ng-container>

      <ng-container matColumnDef="toState">
        <th mat-header-cell *matHeaderCellDef>To State</th>
        <td mat-cell *matCellDef="let transition">
          <span class="state-badge">{{ getStateName(transition.toStateId) }}</span>
        </td>
      </ng-container>

      <ng-container matColumnDef="requiresComment">
        <th mat-header-cell *matHeaderCellDef>Requires Comment</th>
        <td mat-cell *matCellDef="let transition">
          <mat-icon *ngIf="transition.requiresComment" color="primary">check_circle</mat-icon>
          <span *ngIf="!transition.requiresComment">-</span>
        </td>
      </ng-container>

      <ng-container matColumnDef="isActive">
        <th mat-header-cell *matHeaderCellDef>Status</th>
        <td mat-cell *matCellDef="let transition">
          <span [class.active]="transition.isActive !== false" [class.inactive]="transition.isActive === false" class="status-badge">
            {{ transition.isActive !== false ? 'Active' : 'Inactive' }}
          </span>
        </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let transition">
          <button mat-icon-button (click)="openViewConditionsDialog(transition)" matTooltip="View Conditions">
            <mat-icon>rule</mat-icon>
          </button>
          <button mat-icon-button color="accent" (click)="selectTransition(transition)" matTooltip="Configure Permissions">
            <mat-icon>lock</mat-icon>
          </button>
          <button mat-icon-button color="primary" (click)="openEditDialog(transition)" matTooltip="Edit">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button color="warn" (click)="deleteTransition(transition)" matTooltip="Delete">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" [attr.colspan]="displayedColumns.length">
          <div class="no-data">
            <mat-icon>inbox</mat-icon>
            <p>No transitions found. Add transitions to connect states.</p>
          </div>
        </td>
      </tr>
    </table>
  </div>
</div>
